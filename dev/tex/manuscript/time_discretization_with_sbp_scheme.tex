%!TEX root = SISC_elastic_3d.tex
\subsection{Time discretization with SBP scheme}
In the following, we give the detailed procedures about how we apply the fourth order time integrator to the problems (\ref{elastic_semi_c}) and  (\ref{fine_scheme}). 

Let ${\bf c}^{n}$ and ${\bf f}^{n}$ denote the numerical approximations of ${\bf C}({\bf x},t_n), {\bf x}\in\Omega^c$ and ${\bf F}({\bf x},t_n), {\bf x}\in\Omega^f$ respectively. Here, $t_n = n\Delta_t, n = 0,1,\cdots$ and $\Delta_t > 0$ is a constant time step. We present the fourth order time integrator with predictor and corrector in the Algorithm \ref{first_alg}.
~\\
\begin{breakablealgorithm}
	\caption{Fourth order accurate time stepping for the elastic wave equation with SBP discretization in space}\label{first_alg}
	Given initial conditions $\wt{{\bf c}}^{0}, \wt{{\bf c}}^{-1}$ and ${\bf f}^{0}, {\bf f}^{-1}$ that satisfy the discretized interface conditions.
	
	\begin{itemize}
		\item  {Compute the predictor at the interior grid points for both fine and coarse domains
			\begin{equation*}
			{\bf c}^{*,n+1} = 2{\bf c}^{n} - {\bf c}^{n-1} + \Delta_t^2(\varrho^{2h})^{-1}{\wt{\mathcal{L}}}^{2h} \wt{\bf{c}}^{n},\ \ \ 
			{\bf f}^{*,n+1} = 2{\bf f}^{n} - {\bf f}^{n-1} + \Delta_t^2(\varrho^h)^{-1}\hat{\mathcal{L}}^{h} {\bf{f}}^{n}
			\end{equation*}
		}
		\item{For the continuity of solution on the interface $\Gamma$, assign the value ${\bf f}_{\Gamma}^{*,n+1}$ to satisfy
			\begin{equation*}
			{\bf f}^{*,n+1}_{\Gamma} = \wt{\mathcal{P}}\big({\bf c}^{*,n+1}_{\Gamma}\big)
			\end{equation*}
		}
		\item{For the continuity of traction on the interface $\Gamma$, assign the ghost points value in $\wt{\bf c}^{*,n+1}$ to satisfy
			\begin{equation}\label{traction_gamma_pre}
			(\mathcal{B}^{2h}{\mathcal J}_{\Gamma}^{2h})^{-1}(\wt{\mathcal{A}}_3^{2h}\wt{\bf c}^{*,n+1})\big|_\Gamma
			= \wt{\mathcal{R}}\left((\mathcal{B}^{h}{\mathcal J}^h_{\Gamma})^{-1}((\mathcal{A}_3^h{\bf f}^{*,n+1})\big|_\Gamma-h_3\omega_1{\bm \eta}^{\ast,n+1})\right)
			\end{equation}
			with the definition of $\wt{\mathcal{A}}_3^{2h}$ in (\ref{hatAc}), $\mathcal{A}_3^h$ in (\ref{hatAf}) 
		}
		\item{Evaluate the acceleration at all grids 
			\begin{equation*}
			\wt{\bf c}^n= \frac{\wt{\bf c}^{*,n+1}-2\wt{\bf c}^{n}+\wt{\bf c}^{n-1}}{\Delta^2_t},\ \ \ \
			{\bf f}^{n} = \frac{{\bf f}^{*,n+1}-2{\bf f}^{n}+{\bf f}^{n-1}}{\Delta^2_t}
			\end{equation*}
		}
		\item{Compute the corrector at the interior grid points
			\begin{equation*}
			{\bf c}^{n+1} = {\bf c}^{*,n+1} + \frac{\Delta_t^4}{12}(\varrho^{2h})^{-1}\wt{\mathcal{L}}^{2h}\wt{\bf{c}}^{n},\ \ \ 
			{\bf f}^{n+1} = {\bf f}^{*,n+1} + \frac{\Delta_t^4}{12}(\varrho^{h})^{-1}\hat{\mathcal{L}}^{h}{\bf{f}}^{n}
			\end{equation*}
		}
		\item{For the continuity of solution on the interface $\Gamma$, assign the value ${\bf f}^{n+1}_\Gamma$ to satisfy
			\begin{equation*}
			{\bf f}^{n+1}_{\Gamma} = \wt{\mathcal{P}}\big({\bf c}^{n+1}_{\Gamma}\big)
			\end{equation*}
		}
		\item{For the continuity of traction on the interface $\Gamma$, assign the ghost point value in $\wt{\bf c}^{n+1}$ to satisfy
			\begin{equation}\label{traction_gamma_corr}
			(\mathcal{B}^{2h}{\mathcal J}_{\Gamma}^{2h})^{-1}(\wt{\mathcal{A}}_3^{2h}\wt{\bf c}^{n+1})\big|_\Gamma
			= \wt{\mathcal{R}}\left((\mathcal{B}^{h}{\mathcal J}^h_{\Gamma})^{-1}((\mathcal{A}_3^h{\bf f}^{n+1})\big|_\Gamma-h_3\omega_1{\bm \eta}^{n+1})\right)
			\end{equation}
			with the definition of $\wt{\mathcal{A}}_3^{2h}$ in (\ref{hatAc}), $\mathcal{A}_3^h$ in (\ref{hatAf})
		}
	\end{itemize}
\end{breakablealgorithm}
~\\
Here, we only give the steps to evolve the elastic wave equation with suitable initial and interface conditions and skip the detailed derivations of the fourth order predictor corrector time integrator. For more details, see  \cite{wang2018fourth}.

In the Algorithm \ref{first_alg}, we need to solve the equations come from the continuity of the traction force for the interface $\Gamma$ in both predictor step (\ref{traction_gamma_pre}) and corrector step (
\ref{traction_gamma_corr}). The structure of (\ref{traction_gamma_pre}) and (\ref{traction_gamma_corr}) are same, for simplicity, we only clarify how we solve (\ref{traction_gamma_pre}) in the predictor step.

Note that there are $3n_1^{2h}n_2^{2h}$ unknowns in (\ref{traction_gamma_pre}) and $3n_1^{2h}n_2^{2h}$ linear equations in (\ref{traction_gamma_pre}). Since it is very expensive to calculate the LU-factorization for a large problem in $3$D and there is no efficient ways to calculate the LU-factorization in a parallel machine, we instead using iterative methods to solve the linear system (\ref{traction_gamma_pre}). In particular, we consider three different iterative methods: block Jacobian iterative method, conjugate gradient iterative method and preconditioned conjugate gradient iterative method. The details are given in Section \ref{iterative_section}.
