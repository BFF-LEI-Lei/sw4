\documentclass[a4paper]{article}

\usepackage[english]{babel}
\usepackage[utf8]{inputenc}
\usepackage{amsmath}
\usepackage{graphicx}
\usepackage[colorinlistoftodos]{todonotes}
\usepackage{tikz}
\usetikzlibrary{arrows}
\usepackage{booktabs}
\usepackage{threeparttable}
\usepackage{tikz}
\usetikzlibrary{arrows.meta}
\usepackage{pgfplots}
\usepackage{subcaption}
\usepackage[toc,page]{appendix}
\usepackage{bm}

\title{Fourth order summation-by-parts finite difference methods for wave propagation in 3D anisotropic elastic materials and curvilinear coordinates with mesh refinement interfaces}

\date{\today}

\begin{document}
\maketitle

\begin{abstract}
We analyze
\end{abstract}

\section{Introduction}

\section{The anisotropic elastic wave equation in Cartesian coordinates}
We consider the anistropic elastic wave equation in three dimensional domain ${\bf x} \in \Omega$, ${\bf x} = (x_1,x_2,x_3)^T$ are Cartesian coordinates. Denote ${\bf u} = (u_1,u_2,u_3)^T$ to be the three dimensional displacement vector in Cartesian coordinates, then the elastic wave equation in Cartisian coordinates takes the form,
\begin{eqnarray*}
    \rho\frac{\partial^2{\bf u}}{\partial^2 t} &=& \nabla\cdot\mathcal{T} + {\bf F}, \ \ \ {\bf x}\in\Omega,\ \ \ t\geq 0,\\
    \nabla\cdot\mathcal{T} &:=& {\bf Lu},
\end{eqnarray*}
provided with appropriate initial and boundary conditions. Here, $\rho$ is density, $\mathcal{T}$ is stress tensor and ${\bf F}$ is the force function. The spatial operator ${\bf L}$ is called $3\times3$ symmetric Kelvin-Christoffel differential operator matrix, specifically,
\begin{equation*}
    {\bf L u} = \partial_1(A_1\nabla{\bf u}) + \partial_2(A_2\nabla{\bf u}) + \partial_3(A_3\nabla{\bf u}),
\end{equation*}
with
\begin{eqnarray*}
A_1\nabla{\bf u} &:=& M^{11}\partial_1{\bf u} + M^{12}\partial_2{\bf u} + M^{13}\partial_3{\bf u}, \\
A_2\nabla{\bf u} &:=& M^{21}\partial_1{\bf u} + M^{22}\partial_2{\bf u} + M^{23}\partial_3{\bf u}, \\
A_3\nabla{\bf u} &:=& M^{31}\partial_1{\bf u} + M^{32}\partial_2{\bf u} + M^{33}\partial_3{\bf u},
\end{eqnarray*}
where $M^{i,j}, i = 1,2,3, j = 1,2,3$ are determined by the material properties. For example, for isotropic elastic material,
\[ M^{11} = \left(\begin{array}{ccc}
2\mu+\lambda & 0 & 0\\
0 & \mu & 0\\
0 & 0 & \mu\end{array}\right), M^{12} = \left(\begin{array}{ccc}
0 & \lambda & 0\\
\mu & 0 & 0\\
0 & 0 & 0\end{array}\right), M^{13} = \left(\begin{array}{ccc}
0 & 0 & \lambda\\
0 & 0 & 0\\
\mu & 0 & 0\end{array}\right),\]


\section{Generalization to curvilinear coordinates}
Present the transformed equation. Notation is important. We can write a few formulas first, and discuss if it is good notation. Maybe we shall follow notations from one of Anders' papers?

\subsection{Energy Estimate}
We derive an energy estimate, which tells us what interface conditions we shall impose. Also discuss boundary conditions. Be careful with the Jacobian.

These two sections should not be too long. We shall cite previous works by Petersson and Sj√∂green, and also Duru and Virta 2014. 

Firstly, we define the scalar product 
\begin{equation*}
({\bf u}, {\bf v})_h = h_1h_2h_3\sum_{i=1}^{n_1}\sum_{j=1}^{n_2}\sum_{k=1}^{n_3}\omega_i^{(1)}\omega_j^{(2)}\omega_k^{(3)}J_{i,j,k}{\bf u}^{T}_{i,j,k}{\bf v}_{i,j,k},
\end{equation*}
and the scalar product on the interface $\Gamma$,
\begin{equation*}
({\bf u}, {\bf v})_{h,\Gamma} = h_1h_2\sum_{i=1}^{n_1}\sum_{j=1}^{n_2}\omega_i^{(1)}\omega_j^{(2)}J_{i,j,k}\big|\nabla r^{3}\big|{\bf u}_{i,j,k}^{T}{\bf v}_{i,j,k},
\end{equation*}
where $k = 1$ for the interface of fine domain and $k = n_3^c$ for the interface of coarse domain.

Now we define our scheme
\begin{multline}\label{coarse_scheme}
\rho^c ({\bf u}_{tt}^c)_{i,j,k} = \frac{1}{J_{i,j,k}^c}\big[G_1^c(N_{11}^c){\bf u}_{i,j,k}^c+G_2^c(N_{22}^c){\bf u}_{i,j,k}^c+\tilde{G}_3^c(N_{33}^c){\bf u}_{i,j,k}^c\\
+D_1^c(N_{12}^cD_2^c{\bf u}_{i,j,k}^c)+D_1^c(N_{13}^cD_3^c{\bf u}_{i,j,k}^c)+D_2^c(N_{21}^cD_1^c{\bf u}_{i,j,k}^c)+D_2^c(N_{23}^cD_3^c{\bf u}_{i,j,k}^c)\\
+D_3^c(N_{31}^cD_1^c{\bf u}_{i,j,k}^c)+D_3^c(N_{32}^cD_2^c{\bf u}_{i,j,k}^c)\big],
\end{multline}
for $ i = 1,2,\cdots,n_1^c, j = 1,2,\cdots,n_2^c, k = 1,2,\cdots,n_3^c$ , and 
\begin{multline}\label{fine_scheme_2}
\rho^f ({\bf u}_{tt}^f)_{i,j,k} =
 \frac{1}{J_{i,j,k}^f}\big[G_1^f(N_{11}^f){\bf u}_{i,j,k}^f+G_2^f(N_{22}^f){\bf u}_{i,j,k}^f+G_3^f(N_{33}^f){\bf u}_{i,j,k}^f\\
+D_1^f(N_{12}^fD_2^f{\bf u}_{i,j,k}^f)+D_1^f(N_{13}^fD_3^f{\bf u}_{i,j,k}^f)
+D_2^f(N_{21}^fD_1^f{\bf u}_{i,j,k}^f)+D_2^f(N_{23}^fD_3^f{\bf u}_{i,j,k}^f)\\
+D_3^f(N_{31}^fD_1^f{\bf u}_{i,j,k}^f)
+D_3^f(N_{32}^fD_2^f{\bf u}_{i,j,k}^f)\big],
\end{multline}
for $ i = 1,2,\cdots,n_1^f, j = 1,2,\cdots,n_2^f, k = 2,\cdots,n_3^f$ and
\begin{multline}\label{fine_scheme_1}
\rho^f ({\bf u}_{tt}^f)_{i,j,1} = \frac{1}{J_{i,j,1}^f}\big[G_1^f(N_{11}^f){\bf u}_{i,j,1}^f+G_2^f(N_{22}^f){\bf u}_{i,j,1}^f+G_3^f(N_{33}^f){\bf u}_{i,j,1}^f\\
+D_1^f(N_{12}^fD_2^f{\bf u}_{i,j,1}^f)+D_1^f(N_{13}^fD_3^f{\bf u}_{i,j,1}^f)+D_2^f(N_{21}^fD_1^f{\bf u}_{i,j,1}^f)+D_2^f(N_{23}^fD_3^f{\bf u}_{i,j,1}^f)\\
+D_3^f(N_{31}^fD_1^f{\bf u}_{i,j,1}^f)+D_3^f(N_{32}^fD_2^f{\bf u}_{i,j,1}^f)+{\bm \eta}_{i,j}\big],
\end{multline}
for $ i = 1,2,\cdots,n_1^f, j = 1,2,\cdots,n_2^f$, and
\begin{equation*}
{\bm \eta} = 
\end{equation*}
Multiplying (\ref{coarse_scheme}) by $h_1^ch_2^ch_3^c\omega_i^{(1)}\omega_j^{(2)}\omega_k^{3}J_{i,j,k}^c$ and summing over all grids, we have
\begin{equation}\label{coarse_simple}
({\bf u}_t^c, \rho^c{\bf u}_{tt}^c)_{h^c} = -S_{h^c}({\bf u}_t^c,{\bf u}^c) + B_{h^c}({\bf u}_t^c,{\bf u}^c),
\end{equation}
multiplying (\ref{fine_scheme_1}) by $h_1^fh_2^fh_3^f\omega_i^{(1)}\omega_j^{(2)}\omega_k^{3}J_{i,j,k}^f$ and summing over all grids, we obtain
\begin{multline}\label{fine_simple}
({\bf u}_t^f, \rho^f{\bf u}_{tt}^f)_{h^f} = -S_{h^f}({\bf u}_t^f,{\bf u}^f) + B_{h^f}({\bf u}_t^f,{\bf u}^f) \\
+h_3^f\omega_1^{(3)}h_1^fh_2^f\sum_{i=1}^{n_1^f}\sum_{j=1}^{n_2^f}\omega_i^{(1)}\omega_j^{(2)}({\bf u}_t^f)_{i,j,1}^{T}{\bm \eta}_{i,j},
\end{multline}
where  $S_h$ can be found in Appendix, and 
\begin{multline*}
B_h({\bf u}_t, {\bf u}) = h_2h_3\sum_{j=1}^{n_2}\sum_{k=1}^{n_3}\omega_j^{(2)}\omega_j^{(3)}\big[({\bf u}_t)_{i,j,k}^{T}\bar{A}_1\bar{\nabla}{\bf u}_{i,j,k}\big]_{i=1}^{i=n_1}\\
+h_1h_3\sum_{i=1}^{n_1}\sum_{k=1}^{n_3}\omega_j^{(1)}\omega_j^{(3)}\big[({\bf u}_t)_{i,j,k}^{T}\bar{A}_2\bar{\nabla}{\bf u}_{i,j,k}\big]_{j=1}^{i=n_2}\\
+h_1h_2\sum_{i=1}^{n_1}\sum_{j=1}^{n_2}\omega_i^{(1)}\omega_j^{(2)}\big[({\bf u}_t)_{i,j,k}^{T}\bar{A}_3\bar{\nabla}{\bf u}_{i,j,k}\big]_{k=1}^{k=n_3},
\end{multline*}
where $\bar{A}_1, \bar{A}_2$ and $\bar{A}_3$ can be found in Appendix.  We firstly impose homogeneous Dirichlet boundary condition,
\begin{equation*}
{\bf u}_{i,j,k} = {\bf 0}
\end{equation*}
to the left and right boundaries ($i = 1,n_1, j = 1,2,\cdots,n_2,k = 1,2,\cdots,n_3$), to the front and back boundaries ($i = 1,2,\cdots,n_1, j = 1,n_2,k = 1,2,\cdots,n_3$) and to the bottom boundaries ($i = 1,2,\cdots,n_1, j = 1,2,\cdots,n_3, k = 1$). Finally, we consider a free-surface condition on the top boundaries ($i = 1,2,\cdots,n_1, j = 1,2,\cdots,n_2, k = n_3$),
\begin{equation*}
\bar{A}_3^f\bar{\nabla} {\bf u}_{i,j,n_3^f}^f = {\bf 0}.
\end{equation*}
Then, we have
\begin{equation}\label{boundary_f}
B_{h_f} ({\bf u}_t^f,{\bf u}^f) = -h_1^fh_2^f\sum_{i = 1}^{i = n_1^f}\sum_{j=1}^{j=n_2^f}\omega_i^{(1)}\omega_j^{(2)}({\bf u}_t^f)^T_{i,j,1}\bar{A}_3^f\bar{\nabla}_f{\bf u}^f_{i,j,1},
\end{equation}
and 
\begin{equation}\label{bounary_c}
B_{h_c} ({\bf u}_t^c,{\bf u}^c) = h_1^ch_2^c\sum_{i = 1}^{i = n_1^c}\sum_{j=1}^{j=n_2^c}\omega_i^{(1)}\omega_j^{(2)}({\bf u}_t^f)^T_{i,j,n_3^c}\bar{A}_3^c\bar{\nabla}_c{\bf u}^c_{i,j,n_3^c}.
\end{equation}
Finally, the semi-discrete energy estimate
\begin{multline}\label{semi_energy_1}
\frac{d}{dt}\big[({\bf u}_t^f,\rho^f {\bf u}_t^f)_{h^f} + S_{h^f}({\bf u}^f,{\bf u}^f_t) + ({\bf u}_t^c,\rho^c {\bf u}_t^c)_{h^c} + S_{h^c}({\bf u}^c,{\bf u}^c_t) \big]  = \\
2B_{h^f}({\bf u}_t^f,{\bf u}^f) + 2B_{h^c}({\bf u}_t^c,{\bf u}^c) + 2h_3^f\omega_1^{(3)}h_1^f h_2^f\sum_{i=1}^{n_1^f}\sum_{j=1}^{n_2^f}\omega_i^{(1)}\omega_j^{(2)}({\bf u}_t^f)^T_{i,j,1}{\bm \eta}_{i,j},
\end{multline}
plugging (\ref{boundary_f}) and (\ref{bounary_c}) into (\ref{semi_energy_1}), we have
\begin{multline}\label{semi_energy_2}
\frac{d}{dt}\big[({\bf u}_t^f,\rho^f {\bf u}_t^f)_{h^f} + S_{h^f}({\bf u}^f,{\bf u}^f_t) + ({\bf u}_t^c,\rho^c {\bf u}_t^c)_{h^c} + S_{h^c}({\bf u}^c,{\bf u}^c_t) \big]  = \\
2\Big(-{\bf u}_t^f,\frac{\bar{A}_3^f\bar{\nabla}_f{\bf u}^f}{J^f|\nabla r_f^{(3)}|}\Big)_{h_f,\Gamma} + 2\Big({\bf u}_t^c,\frac{\bar{A}_3^c\bar{\nabla}_c{\bf u}^c}{J^c|\nabla r_c^{(3)}|}\Big)_{h_c,\Gamma} + 2\Big({\bf u}_t^f,\frac{{\bm \eta}}{J^f|\nabla r_f^{(3)}|}\Big)_{h_f,\Gamma} = \\
2\Big({\bf u}_t^f,-\frac{\bar{A}_3^f\bar{\nabla}_f{\bf u}^f}{J^f|\nabla r_f^{(3)}|} + \frac{{\bm \eta}}{J^f|\nabla r_f^{(3)}|}\Big)_{h_f,\Gamma} +  2\Big({\bf u}_t^c,\frac{\bar{A}_3^c\bar{\nabla}_c{\bf u}^c}{J^c|\nabla r_c^{(3)}|}\Big)_{h_c,\Gamma} 
\end{multline}


\section{The spatial discretization}
We present the SBP operators, the semi-discrete equation, and the discretized boundary conditions and interface conditions. Also a semi-discrete energy estimate (if we do not write a fully discrete energy estimate).

\section{The temporal discretization}
We present the predictor-corrector discretization in time, and explain how the ghost points are updated. In addtion, we describle the iterative methods. Perhaps we shall also talk about CFL and the time steps. Maybe no fully-discrete energy analysis? That would be very messy. 


\section{Numerical Experiments}

\subsection{Verification of convergence rate}
Show fourth order convergence

\subsection{Gaussian source}
Show that no reflection at the mesh refinement interfaces. 

If the code is incorporated into SW4, it would be nice to solve a practical problem. 

\subsection{Experiment 3}
We shall have an experiment for energy conservation. We also need to evaluate the iterative methods. These can be Experiment 3, or incoporated in the first two experiments.

\section{Conclusion}
\end{document}
